"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ReservationService_1 = require("../../services/ReservationService");
var ReservationPlaceService_1 = require("../../services/ReservationPlaceService");
var Reservation_1 = require("../../models/Reservation");
var util = require("../../utils/util");
var reservationSvc = new ReservationService_1.ReservationService();
var reservationPlaceSvc = new ReservationPlaceService_1.ReservationPlaceService();
Page({
    data: {
        stepIndex: 0,
        places: [],
        placeNames: [],
        currentDate: new Date().getTime(),
        maxDate: util.addDays(new Date(), 7).getTime(),
        reservation: new Reservation_1.Reservation(),
        reservationPeriods: [],
        checkedPeriods: [],
    },
    onLoad: function (params) {
        var _this = this;
        console.log(params);
        reservationPlaceSvc.GetAll(function (result) {
            _this.setData({
                places: result,
                placeNames: result.map(function (p) { return p.PlaceName; })
            });
        });
    },
    onStepChange: function () {
        var _this = this;
        console.log("stepIndex:" + this.data.stepIndex + ",reservationInfo: " + JSON.stringify(this.data.reservation));
        switch (this.data.stepIndex) {
            case 0:
                break;
            case 1:
                if (!this.data.reservation.ReservationPlaceId) {
                    this.data.reservation.ReservationPlaceId = this.data.places[0].PlaceId;
                    this.data.reservation.ReservationPlaceName = this.data.places[0].PlaceName;
                }
                break;
            case 2:
                if (!this.data.reservation.ReservationForDate) {
                    this.data.reservation.ReservationForDate = util.formatDate(new Date());
                }
                reservationPlaceSvc.getAvailablePeriods(function (result) {
                    console.log(result);
                    _this.setData({
                        reservationPeriods: result
                    });
                }, this.data.reservation.ReservationPlaceId, this.data.reservation.ReservationForDate);
                break;
            case 3:
                console.log(this.data.reservationPeriods);
                this.data.reservation.ReservationForTimeIds = this.data.reservationPeriods.filter(function (_) { return _.Checked; }).map(function (x) { return x.PeriodIndex; }).join(",");
                this.data.reservation.ReservationForTime = this.data.reservationPeriods.filter(function (_) { return _.Checked; }).map(function (x) { return x.PeriodTitle; }).join(",");
                break;
            case 4:
                this.setData({
                    reservation: this.data.reservation
                });
                break;
        }
        return false;
    },
    prevStep: function (event) {
        this.data.stepIndex--;
        if (this.onStepChange()) {
        }
        this.setData({
            stepIndex: this.data.stepIndex
        });
    },
    nextStep: function (event) {
        this.data.stepIndex++;
        if (this.onStepChange()) {
        }
        this.setData({
            stepIndex: this.data.stepIndex
        });
    },
    onPlaceChange: function (event) {
        var _a = event.detail, picker = _a.picker, value = _a.value, index = _a.index;
        this.data.reservation.ReservationPlaceId = this.data.places[index].PlaceId;
        this.data.reservation.ReservationPlaceName = this.data.places[index].PlaceName;
    },
    onDateInput: function (event) {
        var dateStr = util.formatDate(new Date(event.detail));
        console.log("date: " + dateStr);
        this.data.reservation.ReservationForDate = dateStr;
    },
    onPeriodsChange: function (event) {
        console.log(event);
        var idxs = new Array();
        for (var _i = 0, _a = event.detail; _i < _a.length; _i++) {
            var name_1 = _a[_i];
            var idx = Number.parseInt(name_1.substr(7));
            idxs.push(idx);
        }
        for (var _b = 0, _c = this.data.reservationPeriods; _b < _c.length; _b++) {
            var p = _c[_b];
            if (idxs.indexOf(p.PeriodIndex) > -1) {
                p.Checked = true;
            }
        }
        this.setData({
            checkedPeriods: event.detail
        });
    },
    onUnitChange: function (event) {
        console.log(event);
        this.data.reservation.ReservationUnit = event.detail;
    },
    onActivityContentChange: function (event) {
        console.log(event);
        this.data.reservation.ReservationActivityContent = event.detail;
    },
    onPersonNameChange: function (event) {
        console.log(event);
        this.data.reservation.ReservationPersonName = event.detail;
    },
    onPersonPhoneChange: function (event) {
        console.log(event);
        this.data.reservation.ReservationPersonPhone = event.detail;
    },
    submit: function (event) {
        reservationSvc.NewReservation(function (result) {
            console.log(result);
        }, this.data.reservation, 'None', '');
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV3LXJlc2VydmF0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibmV3LXJlc2VydmF0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0VBQXVFO0FBQ3ZFLGtGQUFpRjtBQUNqRix3REFBdUQ7QUFJdkQsdUNBQXlDO0FBRXpDLElBQU0sY0FBYyxHQUFHLElBQUksdUNBQWtCLEVBQUUsQ0FBQztBQUNoRCxJQUFNLG1CQUFtQixHQUFHLElBQUksaURBQXVCLEVBQUUsQ0FBQztBQUUxRCxJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixTQUFTLEVBQUUsQ0FBQztRQUNaLE1BQU0sRUFBRSxFQUE2QjtRQUNyQyxVQUFVLEVBQUUsRUFBbUI7UUFDL0IsV0FBVyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFO1FBQ2pDLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFO1FBQzlDLFdBQVcsRUFBRSxJQUFJLHlCQUFXLEVBQUU7UUFDOUIsa0JBQWtCLEVBQUUsRUFBOEI7UUFDbEQsY0FBYyxFQUFFLEVBQW1CO0tBQ3BDO0lBQ0QsTUFBTSxFQUFOLFVBQU8sTUFBVztRQUFsQixpQkFTQztRQVJDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFcEIsbUJBQW1CLENBQUMsTUFBTSxDQUFDLFVBQUMsTUFBTTtZQUMxQixLQUFLLENBQUMsT0FBTyxDQUFDO2dCQUNsQixNQUFNLEVBQUUsTUFBTTtnQkFDZCxVQUFVLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxTQUFTLEVBQVgsQ0FBVyxDQUFDO2FBQ3pDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUNELFlBQVksRUFBWjtRQUFBLGlCQXdDQztRQXZDQyxPQUFPLENBQUMsR0FB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QUFNLENBQUM7SUFDN0QsQ0FBQztJQUNELG1CQUFtQixFQUFuQixVQUFvQixLQUFVO1FBQzVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsc0JBQXNCLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztJQUM5RCxDQUFDO0lBRUQsTUFBTSxFQUFOLFVBQU8sS0FBVTtRQUNmLGNBQWMsQ0FBQyxjQUFjLENBQUMsVUFBQSxNQUFNO1lBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEIsQ0FBQyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN4QyxDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVzZXJ2YXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvUmVzZXJ2YXRpb25TZXJ2aWNlJztcclxuaW1wb3J0IHsgUmVzZXJ2YXRpb25QbGFjZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9SZXNlcnZhdGlvblBsYWNlU2VydmljZSc7XHJcbmltcG9ydCB7IFJlc2VydmF0aW9uIH0gZnJvbSAnLi4vLi4vbW9kZWxzL1Jlc2VydmF0aW9uJztcclxuaW1wb3J0IHsgUmVzZXJ2YXRpb25QbGFjZSB9IGZyb20gJy4uLy4uL21vZGVscy9SZXNlcnZhdGlvblBsYWNlJztcclxuaW1wb3J0IHsgUmVzZXJ2YXRpb25QZXJpb2QgfSBmcm9tICcuLi8uLi9tb2RlbHMvUmVzZXJ2YXRpb25QZXJpb2QnO1xyXG5cclxuaW1wb3J0ICogYXMgdXRpbCBmcm9tICcuLi8uLi91dGlscy91dGlsJztcclxuXHJcbmNvbnN0IHJlc2VydmF0aW9uU3ZjID0gbmV3IFJlc2VydmF0aW9uU2VydmljZSgpO1xyXG5jb25zdCByZXNlcnZhdGlvblBsYWNlU3ZjID0gbmV3IFJlc2VydmF0aW9uUGxhY2VTZXJ2aWNlKCk7XHJcblxyXG5QYWdlKHtcclxuICBkYXRhOiB7XHJcbiAgICBzdGVwSW5kZXg6IDAsXHJcbiAgICBwbGFjZXM6IFtdIGFzIEFycmF5PFJlc2VydmF0aW9uUGxhY2U+LFxyXG4gICAgcGxhY2VOYW1lczogW10gYXMgQXJyYXk8c3RyaW5nPixcclxuICAgIGN1cnJlbnREYXRlOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcclxuICAgIG1heERhdGU6IHV0aWwuYWRkRGF5cyhuZXcgRGF0ZSgpLCA3KS5nZXRUaW1lKCksXHJcbiAgICByZXNlcnZhdGlvbjogbmV3IFJlc2VydmF0aW9uKCksXHJcbiAgICByZXNlcnZhdGlvblBlcmlvZHM6IFtdIGFzIEFycmF5PFJlc2VydmF0aW9uUGVyaW9kPixcclxuICAgIGNoZWNrZWRQZXJpb2RzOiBbXSBhcyBBcnJheTxzdHJpbmc+LFxyXG4gIH0sXHJcbiAgb25Mb2FkKHBhcmFtczogYW55KSB7XHJcbiAgICBjb25zb2xlLmxvZyhwYXJhbXMpO1xyXG5cclxuICAgIHJlc2VydmF0aW9uUGxhY2VTdmMuR2V0QWxsKChyZXN1bHQpID0+IHtcclxuICAgICAgKDxhbnk+dGhpcykuc2V0RGF0YSh7XHJcbiAgICAgICAgcGxhY2VzOiByZXN1bHQsXHJcbiAgICAgICAgcGxhY2VOYW1lczogcmVzdWx0Lm1hcChwID0+IHAuUGxhY2VOYW1lKVxyXG4gICAgICB9KTtcclxuICAgIH0pXHJcbiAgfSxcclxuICBvblN0ZXBDaGFuZ2UoKTogYm9vbGVhbiB7XHJcbiAgICBjb25zb2xlLmxvZyhgc3RlcEluZGV4OiR7dGhpcy5kYXRhLnN0ZXBJbmRleH0scmVzZXJ2YXRpb25JbmZvOiAke0pTT04uc3RyaW5naWZ5KHRoaXMuZGF0YS5yZXNlcnZhdGlvbil9YCk7XHJcbiAgICBzd2l0Y2ggKHRoaXMuZGF0YS5zdGVwSW5kZXgpIHtcclxuICAgICAgY2FzZSAwOlxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIDE6XHJcbiAgICAgICAgaWYgKCF0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25QbGFjZUlkKSB7XHJcbiAgICAgICAgICB0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25QbGFjZUlkID0gdGhpcy5kYXRhLnBsYWNlc1swXS5QbGFjZUlkO1xyXG4gICAgICAgICAgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uUGxhY2VOYW1lID0gdGhpcy5kYXRhLnBsYWNlc1swXS5QbGFjZU5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIDI6XHJcbiAgICAgICAgaWYgKCF0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25Gb3JEYXRlKSB7XHJcbiAgICAgICAgICB0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25Gb3JEYXRlID0gdXRpbC5mb3JtYXREYXRlKG5ldyBEYXRlKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL1xyXG4gICAgICAgIHJlc2VydmF0aW9uUGxhY2VTdmMuZ2V0QXZhaWxhYmxlUGVyaW9kcyhyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcclxuICAgICAgICAgICg8YW55PnRoaXMpLnNldERhdGEoe1xyXG4gICAgICAgICAgICByZXNlcnZhdGlvblBlcmlvZHM6IHJlc3VsdFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uUGxhY2VJZCwgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uRm9yRGF0ZSk7XHJcblxyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAzOlxyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZGF0YS5yZXNlcnZhdGlvblBlcmlvZHMpO1xyXG4gICAgICAgIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvbkZvclRpbWVJZHMgPSB0aGlzLmRhdGEucmVzZXJ2YXRpb25QZXJpb2RzLmZpbHRlcihfPT5fLkNoZWNrZWQpLm1hcCh4PT54LlBlcmlvZEluZGV4KS5qb2luKFwiLFwiKTtcclxuICAgICAgICB0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25Gb3JUaW1lID0gdGhpcy5kYXRhLnJlc2VydmF0aW9uUGVyaW9kcy5maWx0ZXIoXz0+Xy5DaGVja2VkKS5tYXAoeD0+IHguUGVyaW9kVGl0bGUpLmpvaW4oXCIsXCIpO1xyXG4gICAgXHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlIDQ6XHJcbiAgICAgICAgKDxhbnk+dGhpcykuc2V0RGF0YSh7XHJcbiAgICAgICAgICByZXNlcnZhdGlvbjogdGhpcy5kYXRhLnJlc2VydmF0aW9uXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH0sXHJcblxyXG4gIHByZXZTdGVwKGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMuZGF0YS5zdGVwSW5kZXgtLTtcclxuICAgIGlmICh0aGlzLm9uU3RlcENoYW5nZSgpKSB7XHJcblxyXG4gICAgfVxyXG4gICAgLy9cclxuICAgICg8YW55PnRoaXMpLnNldERhdGEoe1xyXG4gICAgICBzdGVwSW5kZXg6IHRoaXMuZGF0YS5zdGVwSW5kZXhcclxuICAgIH0pO1xyXG4gIH0sXHJcbiAgbmV4dFN0ZXAoZXZlbnQ6IGFueSkge1xyXG4gICAgdGhpcy5kYXRhLnN0ZXBJbmRleCsrO1xyXG4gICAgaWYgKHRoaXMub25TdGVwQ2hhbmdlKCkpIHtcclxuXHJcbiAgICB9XHJcbiAgICAoPGFueT50aGlzKS5zZXREYXRhKHtcclxuICAgICAgc3RlcEluZGV4OiB0aGlzLmRhdGEuc3RlcEluZGV4XHJcbiAgICB9KTtcclxuICB9LFxyXG5cclxuICBvblBsYWNlQ2hhbmdlKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IHsgcGlja2VyLCB2YWx1ZSwgaW5kZXggfSA9IGV2ZW50LmRldGFpbDtcclxuICAgIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvblBsYWNlSWQgPSB0aGlzLmRhdGEucGxhY2VzW2luZGV4XS5QbGFjZUlkO1xyXG4gICAgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uUGxhY2VOYW1lID0gdGhpcy5kYXRhLnBsYWNlc1tpbmRleF0uUGxhY2VOYW1lO1xyXG4gIH0sXHJcblxyXG4gIG9uRGF0ZUlucHV0KGV2ZW50OiBhbnkpIHtcclxuICAgIGxldCBkYXRlU3RyID0gdXRpbC5mb3JtYXREYXRlKG5ldyBEYXRlKGV2ZW50LmRldGFpbCkpO1xyXG4gICAgY29uc29sZS5sb2coYGRhdGU6ICR7ZGF0ZVN0cn1gKTtcclxuICAgIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvbkZvckRhdGUgPSBkYXRlU3RyO1xyXG4gIH0sXHJcblxyXG4gIG9uUGVyaW9kc0NoYW5nZShldmVudDogYW55KSB7XHJcbiAgICBjb25zb2xlLmxvZyhldmVudCk7XHJcblxyXG4gICAgbGV0IGlkeHMgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xyXG4gICAgZm9yIChsZXQgbmFtZSBvZiAoZXZlbnQuZGV0YWlsIGFzIEFycmF5PHN0cmluZz4pKSB7XHJcbiAgICAgIGxldCBpZHggPSBOdW1iZXIucGFyc2VJbnQobmFtZS5zdWJzdHIoNykpOyAgICAgIFxyXG4gICAgICBpZHhzLnB1c2goaWR4KTtcclxuICAgIH1cclxuICAgIGZvcihsZXQgcCBvZiB0aGlzLmRhdGEucmVzZXJ2YXRpb25QZXJpb2RzKXtcclxuICAgICAgaWYoaWR4cy5pbmRleE9mKHAuUGVyaW9kSW5kZXgpID4gLTEpe1xyXG4gICAgICAgIHAuQ2hlY2tlZCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAoPGFueT50aGlzKS5zZXREYXRhKHtcclxuICAgICAgY2hlY2tlZFBlcmlvZHM6IGV2ZW50LmRldGFpbFxyXG4gICAgfSk7XHJcbiAgfSxcclxuXHJcbiAgb25Vbml0Q2hhbmdlKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnNvbGUubG9nKGV2ZW50KTtcclxuICAgIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvblVuaXQgPSBldmVudC5kZXRhaWw7XHJcbiAgfSxcclxuICBvbkFjdGl2aXR5Q29udGVudENoYW5nZShldmVudDogYW55KSB7XHJcbiAgICBjb25zb2xlLmxvZyhldmVudCk7XHJcbiAgICB0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25BY3Rpdml0eUNvbnRlbnQgPSBldmVudC5kZXRhaWw7XHJcbiAgfSxcclxuICBvblBlcnNvbk5hbWVDaGFuZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc29sZS5sb2coZXZlbnQpO1xyXG4gICAgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uUGVyc29uTmFtZSA9IGV2ZW50LmRldGFpbDtcclxuICB9LFxyXG4gIG9uUGVyc29uUGhvbmVDaGFuZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc29sZS5sb2coZXZlbnQpO1xyXG4gICAgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uUGVyc29uUGhvbmUgPSBldmVudC5kZXRhaWw7XHJcbiAgfSxcclxuXHJcbiAgc3VibWl0KGV2ZW50OiBhbnkpIHtcclxuICAgIHJlc2VydmF0aW9uU3ZjLk5ld1Jlc2VydmF0aW9uKHJlc3VsdCA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICB9LCB0aGlzLmRhdGEucmVzZXJ2YXRpb24sICdOb25lJywgJycpO1xyXG4gIH1cclxufSkiXX0=