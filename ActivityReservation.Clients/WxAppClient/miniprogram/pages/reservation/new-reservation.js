"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ReservationService_1 = require("../../services/ReservationService");
var ReservationPlaceService_1 = require("../../services/ReservationPlaceService");
var Reservation_1 = require("../../models/Reservation");
var util = require("../../utils/util");
var reservationSvc = new ReservationService_1.ReservationService();
var reservationPlaceSvc = new ReservationPlaceService_1.ReservationPlaceService();
Page({
    data: {
        stepIndex: 0,
        places: [],
        placeNames: [],
        currentDate: new Date().getTime(),
        maxDate: util.addDays(new Date(), 7).getTime(),
        reservation: new Reservation_1.Reservation(),
        reservationPeriods: [],
        checkedPeriods: [],
    },
    onLoad: function (params) {
        var _this = this;
        console.log(params);
        reservationPlaceSvc.GetAll(function (result) {
            _this.setData({
                places: result,
                placeNames: result.map(function (p) { return p.PlaceName; })
            });
        });
    },
    onStepChange: function () {
        var _this = this;
        console.log("stepIndex:" + this.data.stepIndex + ",reservationInfo: " + JSON.stringify(this.data.reservation));
        switch (this.data.stepIndex) {
            case 0:
                break;
            case 1:
                if (!this.data.reservation.ReservationPlaceId) {
                    this.data.reservation.ReservationPlaceId = this.data.places[0].PlaceId;
                    this.data.reservation.ReservationPlaceName = this.data.places[0].PlaceName;
                }
                break;
            case 2:
                if (!this.data.reservation.ReservationForDate) {
                    this.data.reservation.ReservationForDate = util.formatDate(new Date());
                }
                reservationPlaceSvc.getAvailablePeriods(function (result) {
                    console.log(result);
                    _this.setData({
                        reservationPeriods: result
                    });
                }, this.data.reservation.ReservationPlaceId, this.data.reservation.ReservationForDate);
                break;
            case 3:
                console.log(this.data.reservationPeriods);
                this.data.reservation.ReservationForTimeIds = this.data.reservationPeriods.filter(function (_) { return _.Checked; }).map(function (x) { return x.PeriodIndex; }).join(",");
                this.data.reservation.ReservationForTime = this.data.reservationPeriods.filter(function (_) { return _.Checked; }).map(function (x) { return x.PeriodTitle; }).join(",");
                break;
            case 4:
                this.setData({
                    reservation: this.data.reservation
                });
                break;
        }
        return false;
    },
    prevStep: function (event) {
        this.data.stepIndex--;
        if (this.onStepChange()) {
        }
        this.setData({
            stepIndex: this.data.stepIndex
        });
    },
    nextStep: function (event) {
        this.data.stepIndex++;
        if (this.onStepChange()) {
        }
        this.setData({
            stepIndex: this.data.stepIndex
        });
    },
    onPlaceChange: function (event) {
        var _a = event.detail, picker = _a.picker, value = _a.value, index = _a.index;
        this.data.reservation.ReservationPlaceId = this.data.places[index].PlaceId;
        this.data.reservation.ReservationPlaceName = this.data.places[index].PlaceName;
    },
    onDateInput: function (event) {
        var dateStr = util.formatDate(new Date(event.detail));
        console.log("date: " + dateStr);
        this.data.reservation.ReservationForDate = dateStr;
    },
    onPeriodsChange: function (event) {
        console.log(event);
        var idxs = new Array();
        for (var _i = 0, _a = event.detail; _i < _a.length; _i++) {
            var name_1 = _a[_i];
            var idx = Number.parseInt(name_1.substr(7));
            idxs.push(idx);
        }
        for (var _b = 0, _c = this.data.reservationPeriods; _b < _c.length; _b++) {
            var p = _c[_b];
            if (idxs.indexOf(p.PeriodIndex) > -1) {
                p.Checked = true;
            }
        }
        this.setData({
            checkedPeriods: event.detail
        });
    },
    onUnitChange: function (event) {
        console.log(event);
        this.data.reservation.ReservationUnit = event.detail;
    },
    onActivityContentChange: function (event) {
        console.log(event);
        this.data.reservation.ReservationActivityContent = event.detail;
    },
    onPersonNameChange: function (event) {
        console.log(event);
        this.data.reservation.ReservationPersonName = event.detail;
    },
    onPersonPhoneChange: function (event) {
        console.log(event);
        this.data.reservation.ReservationPersonPhone = event.detail;
    },
    submit: function (event) {
        reservationSvc.NewReservation(function (result) {
            console.log(result);
            if (result.Status == 200) {
                wx.reLaunch({
                    url: '/pages/index/index'
                });
            }
        }, this.data.reservation, 'None', '');
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV3LXJlc2VydmF0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibmV3LXJlc2VydmF0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0VBQXVFO0FBQ3ZFLGtGQUFpRjtBQUNqRix3REFBdUQ7QUFJdkQsdUNBQXlDO0FBRXpDLElBQU0sY0FBYyxHQUFHLElBQUksdUNBQWtCLEVBQUUsQ0FBQztBQUNoRCxJQUFNLG1CQUFtQixHQUFHLElBQUksaURBQXVCLEVBQUUsQ0FBQztBQUUxRCxJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixTQUFTLEVBQUUsQ0FBQztRQUNaLE1BQU0sRUFBRSxFQUE2QjtRQUNyQyxVQUFVLEVBQUUsRUFBbUI7UUFDL0IsV0FBVyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFO1FBQ2pDLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFO1FBQzlDLFdBQVcsRUFBRSxJQUFJLHlCQUFXLEVBQUU7UUFDOUIsa0JBQWtCLEVBQUUsRUFBOEI7UUFDbEQsY0FBYyxFQUFFLEVBQW1CO0tBQ3BDO0lBQ0QsTUFBTSxFQUFOLFVBQU8sTUFBVztRQUFsQixpQkFTQztRQVJDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFcEIsbUJBQW1CLENBQUMsTUFBTSxDQUFDLFVBQUMsTUFBTTtZQUMxQixLQUFLLENBQUMsT0FBTyxDQUFDO2dCQUNsQixNQUFNLEVBQUUsTUFBTTtnQkFDZCxVQUFVLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxTQUFTLEVBQVgsQ0FBVyxDQUFDO2FBQ3pDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUNELFlBQVksRUFBWjtRQUFBLGlCQXdDQztRQXZDQyxPQUFPLENBQUMsR0FB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QUFNLENBQUM7SUFDN0QsQ0FBQztJQUNELG1CQUFtQixFQUFuQixVQUFvQixLQUFVO1FBQzVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsc0JBQXNCLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztJQUM5RCxDQUFDO0lBRUQsTUFBTSxFQUFOLFVBQU8sS0FBVTtRQUNmLGNBQWMsQ0FBQyxjQUFjLENBQUMsVUFBQSxNQUFNO1lBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDcEIsSUFBRyxNQUFNLENBQUMsTUFBTSxJQUFJLEdBQUcsRUFBQztnQkFDdEIsRUFBRSxDQUFDLFFBQVEsQ0FBQztvQkFDVixHQUFHLEVBQUUsb0JBQW9CO2lCQUMxQixDQUFDLENBQUM7YUFDSjtRQUNILENBQUMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDeEMsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlc2VydmF0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL1Jlc2VydmF0aW9uU2VydmljZSc7XHJcbmltcG9ydCB7IFJlc2VydmF0aW9uUGxhY2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvUmVzZXJ2YXRpb25QbGFjZVNlcnZpY2UnO1xyXG5pbXBvcnQgeyBSZXNlcnZhdGlvbiB9IGZyb20gJy4uLy4uL21vZGVscy9SZXNlcnZhdGlvbic7XHJcbmltcG9ydCB7IFJlc2VydmF0aW9uUGxhY2UgfSBmcm9tICcuLi8uLi9tb2RlbHMvUmVzZXJ2YXRpb25QbGFjZSc7XHJcbmltcG9ydCB7IFJlc2VydmF0aW9uUGVyaW9kIH0gZnJvbSAnLi4vLi4vbW9kZWxzL1Jlc2VydmF0aW9uUGVyaW9kJztcclxuXHJcbmltcG9ydCAqIGFzIHV0aWwgZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XHJcblxyXG5jb25zdCByZXNlcnZhdGlvblN2YyA9IG5ldyBSZXNlcnZhdGlvblNlcnZpY2UoKTtcclxuY29uc3QgcmVzZXJ2YXRpb25QbGFjZVN2YyA9IG5ldyBSZXNlcnZhdGlvblBsYWNlU2VydmljZSgpO1xyXG5cclxuUGFnZSh7XHJcbiAgZGF0YToge1xyXG4gICAgc3RlcEluZGV4OiAwLFxyXG4gICAgcGxhY2VzOiBbXSBhcyBBcnJheTxSZXNlcnZhdGlvblBsYWNlPixcclxuICAgIHBsYWNlTmFtZXM6IFtdIGFzIEFycmF5PHN0cmluZz4sXHJcbiAgICBjdXJyZW50RGF0ZTogbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICBtYXhEYXRlOiB1dGlsLmFkZERheXMobmV3IERhdGUoKSwgNykuZ2V0VGltZSgpLFxyXG4gICAgcmVzZXJ2YXRpb246IG5ldyBSZXNlcnZhdGlvbigpLFxyXG4gICAgcmVzZXJ2YXRpb25QZXJpb2RzOiBbXSBhcyBBcnJheTxSZXNlcnZhdGlvblBlcmlvZD4sXHJcbiAgICBjaGVja2VkUGVyaW9kczogW10gYXMgQXJyYXk8c3RyaW5nPixcclxuICB9LFxyXG4gIG9uTG9hZChwYXJhbXM6IGFueSkge1xyXG4gICAgY29uc29sZS5sb2cocGFyYW1zKTtcclxuXHJcbiAgICByZXNlcnZhdGlvblBsYWNlU3ZjLkdldEFsbCgocmVzdWx0KSA9PiB7XHJcbiAgICAgICg8YW55PnRoaXMpLnNldERhdGEoe1xyXG4gICAgICAgIHBsYWNlczogcmVzdWx0LFxyXG4gICAgICAgIHBsYWNlTmFtZXM6IHJlc3VsdC5tYXAocCA9PiBwLlBsYWNlTmFtZSlcclxuICAgICAgfSk7XHJcbiAgICB9KVxyXG4gIH0sXHJcbiAgb25TdGVwQ2hhbmdlKCk6IGJvb2xlYW4ge1xyXG4gICAgY29uc29sZS5sb2coYHN0ZXBJbmRleDoke3RoaXMuZGF0YS5zdGVwSW5kZXh9LHJlc2VydmF0aW9uSW5mbzogJHtKU09OLnN0cmluZ2lmeSh0aGlzLmRhdGEucmVzZXJ2YXRpb24pfWApO1xyXG4gICAgc3dpdGNoICh0aGlzLmRhdGEuc3RlcEluZGV4KSB7XHJcbiAgICAgIGNhc2UgMDpcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAxOlxyXG4gICAgICAgIGlmICghdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uUGxhY2VJZCkge1xyXG4gICAgICAgICAgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uUGxhY2VJZCA9IHRoaXMuZGF0YS5wbGFjZXNbMF0uUGxhY2VJZDtcclxuICAgICAgICAgIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvblBsYWNlTmFtZSA9IHRoaXMuZGF0YS5wbGFjZXNbMF0uUGxhY2VOYW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAyOlxyXG4gICAgICAgIGlmICghdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uRm9yRGF0ZSkge1xyXG4gICAgICAgICAgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uRm9yRGF0ZSA9IHV0aWwuZm9ybWF0RGF0ZShuZXcgRGF0ZSgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9cclxuICAgICAgICByZXNlcnZhdGlvblBsYWNlU3ZjLmdldEF2YWlsYWJsZVBlcmlvZHMocmVzdWx0ID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAoPGFueT50aGlzKS5zZXREYXRhKHtcclxuICAgICAgICAgICAgcmVzZXJ2YXRpb25QZXJpb2RzOiByZXN1bHRcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvblBsYWNlSWQsIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvbkZvckRhdGUpO1xyXG5cclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgMzpcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmRhdGEucmVzZXJ2YXRpb25QZXJpb2RzKTtcclxuICAgICAgICB0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25Gb3JUaW1lSWRzID0gdGhpcy5kYXRhLnJlc2VydmF0aW9uUGVyaW9kcy5maWx0ZXIoXz0+Xy5DaGVja2VkKS5tYXAoeD0+eC5QZXJpb2RJbmRleCkuam9pbihcIixcIik7XHJcbiAgICAgICAgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uRm9yVGltZSA9IHRoaXMuZGF0YS5yZXNlcnZhdGlvblBlcmlvZHMuZmlsdGVyKF89Pl8uQ2hlY2tlZCkubWFwKHg9PiB4LlBlcmlvZFRpdGxlKS5qb2luKFwiLFwiKTtcclxuICAgIFxyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSA0OlxyXG4gICAgICAgICg8YW55PnRoaXMpLnNldERhdGEoe1xyXG4gICAgICAgICAgcmVzZXJ2YXRpb246IHRoaXMuZGF0YS5yZXNlcnZhdGlvblxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9LFxyXG5cclxuICBwcmV2U3RlcChldmVudDogYW55KSB7XHJcbiAgICB0aGlzLmRhdGEuc3RlcEluZGV4LS07XHJcbiAgICBpZiAodGhpcy5vblN0ZXBDaGFuZ2UoKSkge1xyXG5cclxuICAgIH1cclxuICAgIC8vXHJcbiAgICAoPGFueT50aGlzKS5zZXREYXRhKHtcclxuICAgICAgc3RlcEluZGV4OiB0aGlzLmRhdGEuc3RlcEluZGV4XHJcbiAgICB9KTtcclxuICB9LFxyXG4gIG5leHRTdGVwKGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMuZGF0YS5zdGVwSW5kZXgrKztcclxuICAgIGlmICh0aGlzLm9uU3RlcENoYW5nZSgpKSB7XHJcblxyXG4gICAgfVxyXG4gICAgKDxhbnk+dGhpcykuc2V0RGF0YSh7XHJcbiAgICAgIHN0ZXBJbmRleDogdGhpcy5kYXRhLnN0ZXBJbmRleFxyXG4gICAgfSk7XHJcbiAgfSxcclxuXHJcbiAgb25QbGFjZUNoYW5nZShldmVudDogYW55KSB7XHJcbiAgICBjb25zdCB7IHBpY2tlciwgdmFsdWUsIGluZGV4IH0gPSBldmVudC5kZXRhaWw7XHJcbiAgICB0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25QbGFjZUlkID0gdGhpcy5kYXRhLnBsYWNlc1tpbmRleF0uUGxhY2VJZDtcclxuICAgIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvblBsYWNlTmFtZSA9IHRoaXMuZGF0YS5wbGFjZXNbaW5kZXhdLlBsYWNlTmFtZTtcclxuICB9LFxyXG5cclxuICBvbkRhdGVJbnB1dChldmVudDogYW55KSB7XHJcbiAgICBsZXQgZGF0ZVN0ciA9IHV0aWwuZm9ybWF0RGF0ZShuZXcgRGF0ZShldmVudC5kZXRhaWwpKTtcclxuICAgIGNvbnNvbGUubG9nKGBkYXRlOiAke2RhdGVTdHJ9YCk7XHJcbiAgICB0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25Gb3JEYXRlID0gZGF0ZVN0cjtcclxuICB9LFxyXG5cclxuICBvblBlcmlvZHNDaGFuZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc29sZS5sb2coZXZlbnQpO1xyXG5cclxuICAgIGxldCBpZHhzID0gbmV3IEFycmF5PG51bWJlcj4oKTtcclxuICAgIGZvciAobGV0IG5hbWUgb2YgKGV2ZW50LmRldGFpbCBhcyBBcnJheTxzdHJpbmc+KSkge1xyXG4gICAgICBsZXQgaWR4ID0gTnVtYmVyLnBhcnNlSW50KG5hbWUuc3Vic3RyKDcpKTsgICAgICBcclxuICAgICAgaWR4cy5wdXNoKGlkeCk7XHJcbiAgICB9XHJcbiAgICBmb3IobGV0IHAgb2YgdGhpcy5kYXRhLnJlc2VydmF0aW9uUGVyaW9kcyl7XHJcbiAgICAgIGlmKGlkeHMuaW5kZXhPZihwLlBlcmlvZEluZGV4KSA+IC0xKXtcclxuICAgICAgICBwLkNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgKDxhbnk+dGhpcykuc2V0RGF0YSh7XHJcbiAgICAgIGNoZWNrZWRQZXJpb2RzOiBldmVudC5kZXRhaWxcclxuICAgIH0pO1xyXG4gIH0sXHJcblxyXG4gIG9uVW5pdENoYW5nZShldmVudDogYW55KSB7XHJcbiAgICBjb25zb2xlLmxvZyhldmVudCk7XHJcbiAgICB0aGlzLmRhdGEucmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25Vbml0ID0gZXZlbnQuZGV0YWlsO1xyXG4gIH0sXHJcbiAgb25BY3Rpdml0eUNvbnRlbnRDaGFuZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc29sZS5sb2coZXZlbnQpO1xyXG4gICAgdGhpcy5kYXRhLnJlc2VydmF0aW9uLlJlc2VydmF0aW9uQWN0aXZpdHlDb250ZW50ID0gZXZlbnQuZGV0YWlsO1xyXG4gIH0sXHJcbiAgb25QZXJzb25OYW1lQ2hhbmdlKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnNvbGUubG9nKGV2ZW50KTtcclxuICAgIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvblBlcnNvbk5hbWUgPSBldmVudC5kZXRhaWw7XHJcbiAgfSxcclxuICBvblBlcnNvblBob25lQ2hhbmdlKGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnNvbGUubG9nKGV2ZW50KTtcclxuICAgIHRoaXMuZGF0YS5yZXNlcnZhdGlvbi5SZXNlcnZhdGlvblBlcnNvblBob25lID0gZXZlbnQuZGV0YWlsO1xyXG4gIH0sXHJcblxyXG4gIHN1Ym1pdChldmVudDogYW55KSB7XHJcbiAgICByZXNlcnZhdGlvblN2Yy5OZXdSZXNlcnZhdGlvbihyZXN1bHQgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICBpZihyZXN1bHQuU3RhdHVzID09IDIwMCl7XHJcbiAgICAgICAgd3gucmVMYXVuY2goe1xyXG4gICAgICAgICAgdXJsOiAnL3BhZ2VzL2luZGV4L2luZGV4J1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9LCB0aGlzLmRhdGEucmVzZXJ2YXRpb24sICdOb25lJywgJycpO1xyXG4gIH1cclxufSkiXX0=